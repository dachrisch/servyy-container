+./servyy-test.sh:3> ansible-playbook servyy.yml -i testing --skip-tags system.swap,ubuntu_pro

PLAY [Setup core system] *******************************************************
[WARNING]: Host 'servyy-test.lxd' is using the discovered Python interpreter at '/usr/bin/python3.13', but future installation of another Python interpreter could cause a different interpreter to be discovered. See https://docs.ansible.com/ansible-core/2.20/reference_appendices/interpreter_discovery.html for more information.

TASK [Gathering Facts] *********************************************************
ok: [servyy-test.lxd]

TASK [system : Install Prerequisites] ******************************************
ok: [servyy-test.lxd]

TASK [system : Upgrade the OS (apt-get dist-upgrade)] **************************
changed: [servyy-test.lxd]

TASK [system : Install required system packages] *******************************
ok: [servyy-test.lxd]

TASK [system : Ensure a locale exists] *****************************************
ok: [servyy-test.lxd]

TASK [system : Set timezone to Europe/Berlin] **********************************
ok: [servyy-test.lxd]
[WARNING]: Deprecation warnings can be disabled by setting `deprecation_warnings=False` in ansible.cfg.
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/system/tasks/packages.yml:39:7

37   when:
38     - upgrade.changed
39     - ansible_virtualization_type | default('') != 'docker'
         ^ column 7

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [system : Reboot to apply changes] ****************************************
changed: [servyy-test.lxd]

TASK [system : Create a new regular user with sudo privileges] *****************
ok: [servyy-test.lxd]

TASK [system : Add user "cda" to sudo] *****************************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: Importing 'to_native' from 'ansible.module_utils._text' is deprecated. This feature will be removed from ansible-core version 2.24. Use ansible.module_utils.common.text.converters instead.

TASK [system : Set authorized key for remote user] *****************************
ok: [servyy-test.lxd]

TASK [system : Disallow SSH password authentication] ***************************
ok: [servyy-test.lxd]

TASK [system : Create extension drive mount point] *****************************
skipping: [servyy-test.lxd]

TASK [system : Check if device exists] *****************************************
skipping: [servyy-test.lxd]

TASK [system : Fail if device does not exist] **********************************
skipping: [servyy-test.lxd]

TASK [system : Check if device is already formatted] ***************************
skipping: [servyy-test.lxd]

TASK [system : Format device if not already formatted] *************************
skipping: [servyy-test.lxd]

TASK [system : Add extension drive to /etc/fstab] ******************************
skipping: [servyy-test.lxd]

TASK [system : Check if extension drive is already mounted] ********************
skipping: [servyy-test.lxd]

TASK [system : Mount extension drive] ******************************************
skipping: [servyy-test.lxd]

TASK [system : Verify extension drive mounted] *********************************
skipping: [servyy-test.lxd]

TASK [system : Create credential file (used for fstab entry)] ******************
skipping: [servyy-test.lxd]

TASK [system : Check mountpoint exist] *****************************************
skipping: [servyy-test.lxd]

TASK [system : set_fact] *******************************************************
skipping: [servyy-test.lxd]

TASK [system : Get storagebox IP (cached)] *************************************
skipping: [servyy-test.lxd]

TASK [system : set_fact] *******************************************************
skipping: [servyy-test.lxd]

TASK [system : Create fstab entry for folder share] ****************************
skipping: [servyy-test.lxd]

TASK [system : Check if storagebox is already mounted] *************************
skipping: [servyy-test.lxd]

TASK [system : Mount storagebox] ***********************************************
skipping: [servyy-test.lxd]

TASK [system : Check if storagebox mounted] ************************************
skipping: [servyy-test.lxd]

TASK [system : Monitor SSHD] ***************************************************
ok: [servyy-test.lxd]

TASK [system : Remove old SSHD link] *******************************************
ok: [servyy-test.lxd]

TASK [system : Setup logging] **************************************************
ok: [servyy-test.lxd]

TASK [system : Setup http (for status)] ****************************************
ok: [servyy-test.lxd]

TASK [system : Setup alert email] **********************************************
ok: [servyy-test.lxd]

TASK [system : Setup systems check] ********************************************
ok: [servyy-test.lxd]

TASK [system : Setup storagebox check] *****************************************
ok: [servyy-test.lxd]

TASK [system : Create scripts dir] *********************************************
ok: [servyy-test.lxd]

TASK [system : Create docker container check script] ***************************
changed: [servyy-test.lxd] => (item={'name': 'Traefik', 'dir': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Achim Höfer', 'dir': 'achim-hoefer', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Git', 'dir': 'git', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Photoprism', 'dir': 'photoprism', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Bumbleflies', 'dir': 'bumbleflies', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Portainer', 'dir': 'portainer', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'PiHole', 'dir': 'dns', 'depends': 'traefik', 'manual': {}})
changed: [servyy-test.lxd] => (item={'name': 'Personal Website', 'dir': 'me', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Job Management', 'dir': 'jobs', 'depends': 'traefik', 'manual': {}})
changed: [servyy-test.lxd] => (item={'name': 'Passbolt', 'dir': 'pass', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Monitor', 'dir': 'monitor', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Energy', 'dir': 'energy', 'depends': 'traefik'})

TASK [system : Setup container check] ******************************************
changed: [servyy-test.lxd] => (item={'name': 'Traefik', 'dir': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Achim Höfer', 'dir': 'achim-hoefer', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Git', 'dir': 'git', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Photoprism', 'dir': 'photoprism', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Bumbleflies', 'dir': 'bumbleflies', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Portainer', 'dir': 'portainer', 'depends': 'traefik'})
skipping: [servyy-test.lxd] => (item={'name': 'PiHole', 'dir': 'dns', 'depends': 'traefik', 'manual': {}}) 
changed: [servyy-test.lxd] => (item={'name': 'Personal Website', 'dir': 'me', 'depends': 'traefik'})
skipping: [servyy-test.lxd] => (item={'name': 'Job Management', 'dir': 'jobs', 'depends': 'traefik', 'manual': {}}) 
changed: [servyy-test.lxd] => (item={'name': 'Passbolt', 'dir': 'pass', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Monitor', 'dir': 'monitor', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Energy', 'dir': 'energy', 'depends': 'traefik'})

TASK [system : Remove container check for manual jobs] *************************
skipping: [servyy-test.lxd] => (item={'name': 'Traefik', 'dir': 'traefik'}) 
skipping: [servyy-test.lxd] => (item={'name': 'Achim Höfer', 'dir': 'achim-hoefer', 'depends': 'traefik'}) 
skipping: [servyy-test.lxd] => (item={'name': 'Git', 'dir': 'git', 'depends': 'traefik'}) 
skipping: [servyy-test.lxd] => (item={'name': 'Photoprism', 'dir': 'photoprism', 'depends': 'traefik'}) 
skipping: [servyy-test.lxd] => (item={'name': 'Bumbleflies', 'dir': 'bumbleflies', 'depends': 'traefik'}) 
skipping: [servyy-test.lxd] => (item={'name': 'Portainer', 'dir': 'portainer', 'depends': 'traefik'}) 
changed: [servyy-test.lxd] => (item={'name': 'PiHole', 'dir': 'dns', 'depends': 'traefik', 'manual': {}})
skipping: [servyy-test.lxd] => (item={'name': 'Personal Website', 'dir': 'me', 'depends': 'traefik'}) 
changed: [servyy-test.lxd] => (item={'name': 'Job Management', 'dir': 'jobs', 'depends': 'traefik', 'manual': {}})
skipping: [servyy-test.lxd] => (item={'name': 'Passbolt', 'dir': 'pass', 'depends': 'traefik'}) 
skipping: [servyy-test.lxd] => (item={'name': 'Monitor', 'dir': 'monitor', 'depends': 'traefik'}) 
skipping: [servyy-test.lxd] => (item={'name': 'Energy', 'dir': 'energy', 'depends': 'traefik'}) 

TASK [system : Run monit status] ***********************************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/system/tasks/monit.yml:111:9

109     fail_msg: "monit status command failed"
110     success_msg: "monit status command succeeded"
111   when: ansible_virtualization_type | default('') != 'docker'
            ^ column 9

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [system : Assert monit status is callable] ********************************
ok: [servyy-test.lxd] => {
    "changed": false,
    "msg": "monit status command succeeded"
}
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/system/tasks/monit.yml:117:9

115     paths: '/var/lib/monit/events/'
116   register: filesFound
117   when: ansible_virtualization_type | default('') != 'docker'
            ^ column 9

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [system : Check if any events where postponed (maybe mailserver error)] ***
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/system/tasks/monit.yml:122:7

120     msg: 'Some events where postponed'
121   when:
122     - ansible_virtualization_type | default('') != 'docker'
          ^ column 7

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [system : fail] ***********************************************************
skipping: [servyy-test.lxd]

TASK [system : Install fail2ban] ***********************************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/system/templates/fail2ban/jail.local.j2

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [system : Create fail2ban local configuration] ****************************
ok: [servyy-test.lxd]

TASK [system : Create SSH jail filter (customized)] ****************************
ok: [servyy-test.lxd]

TASK [system : Create Traefik access log filter] *******************************
ok: [servyy-test.lxd]

TASK [system : Create Traefik bot/scanner filter] ******************************
ok: [servyy-test.lxd]

TASK [system : Create Traefik crawler rate limiting filter] ********************
ok: [servyy-test.lxd]

TASK [system : Create Loki blocklist filter] ***********************************
ok: [servyy-test.lxd]

TASK [system : Create custom action to sync with Loki blocklist] ***************
ok: [servyy-test.lxd]

TASK [system : Ensure fail2ban service is enabled and running] *****************
ok: [servyy-test.lxd]

TASK [system : Create directory for blocklist scripts] *************************
ok: [servyy-test.lxd]

TASK [system : Deploy Loki blocklist update script] ****************************
ok: [servyy-test.lxd]

TASK [system : Create systemd service for blocklist updates] *******************
ok: [servyy-test.lxd]

TASK [system : Create systemd timer for periodic blocklist updates] ************
ok: [servyy-test.lxd]

TASK [system : Enable and start blocklist update timer] ************************
ok: [servyy-test.lxd]

TASK [system : Create Traefik log directory] ***********************************
ok: [servyy-test.lxd]

TASK [system : Deploy logrotate configuration for Traefik logs] ****************
ok: [servyy-test.lxd]

TASK [system : Create journald config directory] *******************************
ok: [servyy-test.lxd]

TASK [system : Deploy journald retention config] *******************************
ok: [servyy-test.lxd]

TASK [system : Create logrotate config for cleanup logs] ***********************
ok: [servyy-test.lxd] => (item=logrotate-docker-cleanup)
ok: [servyy-test.lxd] => (item=logrotate-kernel-cleanup)

TASK [system : Create cleanup scripts directory] *******************************
ok: [servyy-test.lxd]

TASK [system : Deploy Docker cleanup script] ***********************************
ok: [servyy-test.lxd]

TASK [system : Create Docker cleanup log file with correct permissions] ********
changed: [servyy-test.lxd]

TASK [system : Deploy Docker cleanup systemd service] **************************
ok: [servyy-test.lxd]

TASK [system : Deploy Docker cleanup systemd timer] ****************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/system/tasks/docker_cleanup.yml:51:9

49     state: started
50   become: true
51   when: ansible_virtualization_type | default('') != 'docker'
           ^ column 9

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [system : Enable and start Docker cleanup timer] **************************
ok: [servyy-test.lxd]

TASK [system : Deploy kernel cleanup script] ***********************************
ok: [servyy-test.lxd]

TASK [system : Deploy kernel cleanup systemd service] **************************
ok: [servyy-test.lxd]

TASK [system : Deploy kernel cleanup systemd timer] ****************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/system/tasks/kernel_cleanup.yml:31:9

29     state: started
30   become: true
31   when: ansible_virtualization_type | default('') != 'docker'
           ^ column 9

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [system : Enable and start kernel cleanup timer] **************************
ok: [servyy-test.lxd]

TASK [system : Deploy restic forget/prune script] ******************************
ok: [servyy-test.lxd]

TASK [system : Deploy restic check script] *************************************
ok: [servyy-test.lxd]

TASK [system : Create restic-forget systemd service] ***************************
ok: [servyy-test.lxd]

TASK [system : Create restic-forget systemd timer] *****************************
ok: [servyy-test.lxd]

TASK [system : Enable and start restic-forget timer] ***************************
ok: [servyy-test.lxd]

TASK [system : Create restic-check systemd service] ****************************
ok: [servyy-test.lxd]

TASK [system : Create restic-check systemd timer] ******************************
ok: [servyy-test.lxd]

TASK [system : Enable and start restic-check timer] ****************************
ok: [servyy-test.lxd]

RUNNING HANDLER [system : restart monit] ***************************************
changed: [servyy-test.lxd]

PLAY [Setup user specific options] *********************************************

TASK [Gathering Facts] *********************************************************
ok: [servyy-test.lxd]

TASK [user : Validate required variables] **************************************
ok: [servyy-test.lxd] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [user : Attempt to perform HEAD request to git.lehel.xyz] *****************
skipping: [servyy-test.lxd]

TASK [user : Set reachability fact based on HEAD request result] ***************
skipping: [servyy-test.lxd]

TASK [user : Set reachability fact to true when check is skipped] **************
ok: [servyy-test.lxd]

TASK [user : Clone [ https://github.com/dachrisch/my-prezto.git ] to [ /home/cda/.zprezto ] (branch: master )] ***
ok: [servyy-test.lxd]

TASK [user : Initialize submodules for [ /home/cda/.zprezto ]] *****************
changed: [servyy-test.lxd]

TASK [user : Check lock state] *************************************************
ok: [servyy-test.lxd]

TASK [user : Create temporary keyfile local] ***********************************
skipping: [servyy-test.lxd]

TASK [user : Export local key] *************************************************
skipping: [servyy-test.lxd]

TASK [user : Create temporary keyfile remote] **********************************
skipping: [servyy-test.lxd]

TASK [user : Copy repository key to remote] ************************************
skipping: [servyy-test.lxd]

TASK [user : Unlock repository] ************************************************
skipping: [servyy-test.lxd]

TASK [user : Find config files] ************************************************
ok: [servyy-test.lxd]

TASK [user : Link config files] ************************************************
ok: [servyy-test.lxd] => (item={'path': '/home/cda/.zprezto/runcoms/zpreztorc', 'mode': '0664', 'isdir': False, 'ischr': False, 'isblk': False, 'isreg': True, 'isfifo': False, 'islnk': False, 'issock': False, 'uid': 1001, 'gid': 1001, 'size': 6430, 'inode': 27435887, 'dev': 64513, 'nlink': 1, 'atime': 1768257664.4845257, 'mtime': 1764386834.5289483, 'ctime': 1764386834.5289483, 'gr_name': 'cda', 'pw_name': 'cda', 'wusr': True, 'rusr': True, 'xusr': False, 'wgrp': True, 'rgrp': True, 'xgrp': False, 'woth': False, 'roth': True, 'xoth': False, 'isuid': False, 'isgid': False})
ok: [servyy-test.lxd] => (item={'path': '/home/cda/.zprezto/runcoms/zshrc', 'mode': '0664', 'isdir': False, 'ischr': False, 'isblk': False, 'isreg': True, 'isfifo': False, 'islnk': False, 'issock': False, 'uid': 1001, 'gid': 1001, 'size': 2701, 'inode': 27435890, 'dev': 64513, 'nlink': 1, 'atime': 1768257664.4655256, 'mtime': 1765220126.1605356, 'ctime': 1765220126.1605356, 'gr_name': 'cda', 'pw_name': 'cda', 'wusr': True, 'rusr': True, 'xusr': False, 'wgrp': True, 'rgrp': True, 'xgrp': False, 'woth': False, 'roth': True, 'xoth': False, 'isuid': False, 'isgid': False})
ok: [servyy-test.lxd] => (item={'path': '/home/cda/.zprezto/runcoms/zlogout', 'mode': '0664', 'isdir': False, 'ischr': False, 'isblk': False, 'isreg': True, 'isfifo': False, 'islnk': False, 'issock': False, 'uid': 1001, 'gid': 1001, 'size': 529, 'inode': 27435886, 'dev': 64513, 'nlink': 1, 'atime': 1768258323.6498718, 'mtime': 1764386834.5289483, 'ctime': 1764386834.5289483, 'gr_name': 'cda', 'pw_name': 'cda', 'wusr': True, 'rusr': True, 'xusr': False, 'wgrp': True, 'rgrp': True, 'xgrp': False, 'woth': False, 'roth': True, 'xoth': False, 'isuid': False, 'isgid': False})
ok: [servyy-test.lxd] => (item={'path': '/home/cda/.zprezto/runcoms/zprofile', 'mode': '0664', 'isdir': False, 'ischr': False, 'isblk': False, 'isreg': True, 'isfifo': False, 'islnk': False, 'issock': False, 'uid': 1001, 'gid': 1001, 'size': 1254, 'inode': 27435888, 'dev': 64513, 'nlink': 1, 'atime': 1768222833.153474, 'mtime': 1764386834.5289483, 'ctime': 1764386834.5289483, 'gr_name': 'cda', 'pw_name': 'cda', 'wusr': True, 'rusr': True, 'xusr': False, 'wgrp': True, 'rgrp': True, 'xgrp': False, 'woth': False, 'roth': True, 'xoth': False, 'isuid': False, 'isgid': False})
ok: [servyy-test.lxd] => (item={'path': '/home/cda/.zprezto/runcoms/zshenv', 'mode': '0664', 'isdir': False, 'ischr': False, 'isblk': False, 'isreg': True, 'isfifo': False, 'islnk': False, 'issock': False, 'uid': 1001, 'gid': 1001, 'size': 1310, 'inode': 27435889, 'dev': 64513, 'nlink': 1, 'atime': 1768222833.1524742, 'mtime': 1764386845.7705126, 'ctime': 1764386845.7705126, 'gr_name': 'cda', 'pw_name': 'cda', 'wusr': True, 'rusr': True, 'xusr': False, 'wgrp': True, 'rgrp': True, 'xgrp': False, 'woth': False, 'roth': True, 'xoth': False, 'isuid': False, 'isgid': False})
ok: [servyy-test.lxd] => (item={'path': '/home/cda/.zprezto/runcoms/zlogin', 'mode': '0664', 'isdir': False, 'ischr': False, 'isblk': False, 'isreg': True, 'isfifo': False, 'islnk': False, 'issock': False, 'uid': 1001, 'gid': 1001, 'size': 860, 'inode': 27435885, 'dev': 64513, 'nlink': 1, 'atime': 1768257665.448522, 'mtime': 1764386834.5289483, 'ctime': 1764386834.5289483, 'gr_name': 'cda', 'pw_name': 'cda', 'wusr': True, 'rusr': True, 'xusr': False, 'wgrp': True, 'rgrp': True, 'xgrp': False, 'woth': False, 'roth': True, 'xoth': False, 'isuid': False, 'isgid': False})

TASK [user : Check if custom prompt file exists] *******************************
ok: [servyy-test.lxd]

TASK [user : Link prompt] ******************************************************
ok: [servyy-test.lxd]

TASK [user : Check if atuin is installed] **************************************
ok: [servyy-test.lxd]

TASK [user : Create temporary file for install script] *************************
skipping: [servyy-test.lxd]

TASK [user : Downloading atuin install script] *********************************
skipping: [servyy-test.lxd]

TASK [user : Run install script] ***********************************************
skipping: [servyy-test.lxd]

TASK [user : Link executable] **************************************************
skipping: [servyy-test.lxd]

TASK [user : Login [dachrisch]] ************************************************
ok: [servyy-test.lxd]

TASK [user : Sync] *************************************************************
skipping: [servyy-test.lxd]

TASK [user : Set atuin filenames] **********************************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/user/tasks/atuin.yml:49:11

47 - name: Set auto-sync
48   lineinfile:
49     path: "{{ (ansible_user_dir, config_dir) | path_join }}"
             ^ column 11

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [user : Set auto-sync] ****************************************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/user/tasks/atuin.yml:55:11

53 - name: Set update-check
54   lineinfile:
55     path: "{{ (ansible_user_dir, config_dir) | path_join }}"
             ^ column 11

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [user : Set update-check] *************************************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/user/tasks/atuin.yml:61:11

59 - name: Set filter mode for shell up-key binding
60   lineinfile:
61     path: "{{ (ansible_user_dir, config_dir) | path_join }}"
             ^ column 11

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [user : Set filter mode for shell up-key binding] *************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/dev/infrastructure/container/ansible/plays/roles/user/tasks/atuin.yml:67:11

65 - name: Set enter_accept to false
66   lineinfile:
67     path: "{{ (ansible_user_dir, config_dir) | path_join }}"
             ^ column 11

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [user : Set enter_accept to false] ****************************************
ok: [servyy-test.lxd]

TASK [user : Add credentials for repo [git.lehel.xyz]] *************************
ok: [servyy-test.lxd]

TASK [user : Check helper store] ***********************************************
ok: [servyy-test.lxd]

TASK [user : Configure helper store when not exists] ***************************
skipping: [servyy-test.lxd]

TASK [user : Validate required variables] **************************************
ok: [servyy-test.lxd] => {
    "changed": false,
    "msg": "All assertions passed"
}

TASK [user : Attempt to perform HEAD request to git.lehel.xyz] *****************
ok: [servyy-test.lxd]

TASK [user : Set reachability fact based on HEAD request result] ***************
ok: [servyy-test.lxd]

TASK [user : Set reachability fact to true when check is skipped] **************
skipping: [servyy-test.lxd]

TASK [user : Clone [ https://github.com/dachrisch/servyy-container.git ] to [ /home/cda/servyy-container ] (branch: master )] ***
changed: [servyy-test.lxd]

TASK [user : Initialize submodules for [ /home/cda/servyy-container ]] *********
changed: [servyy-test.lxd]

TASK [user : Check lock state] *************************************************
ok: [servyy-test.lxd]

TASK [user : Create temporary keyfile local] ***********************************
skipping: [servyy-test.lxd]

TASK [user : Export local key] *************************************************
skipping: [servyy-test.lxd]

TASK [user : Create temporary keyfile remote] **********************************
skipping: [servyy-test.lxd]

TASK [user : Copy repository key to remote] ************************************
skipping: [servyy-test.lxd]

TASK [user : Unlock repository] ************************************************
skipping: [servyy-test.lxd]

TASK [user : Create local .env files for docker service] ***********************
ok: [servyy-test.lxd] => (item={'name': 'Traefik', 'dir': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Achim Höfer', 'dir': 'achim-hoefer', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Git', 'dir': 'git', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Photoprism', 'dir': 'photoprism', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Bumbleflies', 'dir': 'bumbleflies', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Portainer', 'dir': 'portainer', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'PiHole', 'dir': 'dns', 'depends': 'traefik', 'manual': {}})
ok: [servyy-test.lxd] => (item={'name': 'Personal Website', 'dir': 'me', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Job Management', 'dir': 'jobs', 'depends': 'traefik', 'manual': {}})
ok: [servyy-test.lxd] => (item={'name': 'Passbolt', 'dir': 'pass', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Monitor', 'dir': 'monitor', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Energy', 'dir': 'energy', 'depends': 'traefik'})

TASK [user : Looking for backup files [/mnt/storagebox/backup/servyy-test.lxd/home/cda/servyy-container/git/repos]] ***
ok: [servyy-test.lxd]

TASK [user : Latest backup file] ***********************************************
ok: [servyy-test.lxd]

TASK [user : Find current repos files] *****************************************
ok: [servyy-test.lxd]

TASK [user : Latest current file] **********************************************
ok: [servyy-test.lxd]

TASK [user : Restore [git/repos] from backup] **********************************
skipping: [servyy-test.lxd]

TASK [user : Ensure file ownership (when not restored)] ************************
ok: [servyy-test.lxd]

TASK [user : Looking for backup files [/mnt/storagebox/backup/servyy-test.lxd/home/cda/servyy-container/photoprism/database]] ***
ok: [servyy-test.lxd]

TASK [user : Latest backup file] ***********************************************
ok: [servyy-test.lxd]

TASK [user : Find current repos files] *****************************************
ok: [servyy-test.lxd]

TASK [user : Latest current file] **********************************************
ok: [servyy-test.lxd]

TASK [user : Restore [photoprism/database] from backup] ************************
skipping: [servyy-test.lxd]

TASK [user : Ensure file ownership (when not restored)] ************************
ok: [servyy-test.lxd]
[WARNING]: Skipped '/mnt/storagebox/backup/servyy-test.lxd/home/cda/servyy-container/pass/vw-data' path due to this access issue: '/mnt/storagebox/backup/servyy-test.lxd/home/cda/servyy-container/pass/vw-data' is not a directory

TASK [user : Looking for backup files [/mnt/storagebox/backup/servyy-test.lxd/home/cda/servyy-container/pass/vw-data]] ***
ok: [servyy-test.lxd]

TASK [user : Latest backup file] ***********************************************
skipping: [servyy-test.lxd]

TASK [user : Find current repos files] *****************************************
ok: [servyy-test.lxd]

TASK [user : Latest current file] **********************************************
ok: [servyy-test.lxd]

TASK [user : Restore [pass/vw-data] from backup] *******************************
skipping: [servyy-test.lxd]

TASK [user : Ensure file ownership (when not restored)] ************************
ok: [servyy-test.lxd]

TASK [user : Gather bumbleflies service dir] ***********************************
ok: [servyy-test.lxd]

TASK [user : Setting working dir for bumbleflies service] **********************
ok: [servyy-test.lxd]

TASK [user : Configure safe directory for /home/cda/servyy-container/bumbleflies/site] ***
ok: [servyy-test.lxd]

TASK [user : Remove ancient docker compose] ************************************
ok: [servyy-test.lxd]

TASK [user : Check if docker group exists] *************************************
ok: [servyy-test.lxd]

TASK [user : adding existing user 'cda' to group docker] ***********************
ok: [servyy-test.lxd]

TASK [user : Reboot to apply changes] ******************************************
skipping: [servyy-test.lxd]

TASK [user : Create external network] ******************************************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: Importing 'to_bytes' from 'ansible.module_utils._text' is deprecated. This feature will be removed from ansible-core version 2.24. Use ansible.module_utils.common.text.converters instead.

TASK [user : Configure docker daemon logging] **********************************
ok: [servyy-test.lxd]

TASK [user : Check if mount point "/mnt/10g_volume" exists] ********************
ok: [servyy-test.lxd]

TASK [user : Configure docker daemon data root] ********************************
skipping: [servyy-test.lxd]

TASK [user : Restart Docker to apply changes] **********************************
skipping: [servyy-test.lxd]

TASK [user : Create docker script for services] ********************************
ok: [servyy-test.lxd]

TASK [user : Start docker services] ********************************************
ok: [servyy-test.lxd] => (item={'name': 'Traefik', 'dir': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Achim Höfer', 'dir': 'achim-hoefer', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Git', 'dir': 'git', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Photoprism', 'dir': 'photoprism', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Bumbleflies', 'dir': 'bumbleflies', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Portainer', 'dir': 'portainer', 'depends': 'traefik'})
skipping: [servyy-test.lxd] => (item={'name': 'PiHole', 'dir': 'dns', 'depends': 'traefik', 'manual': {}}) 
ok: [servyy-test.lxd] => (item={'name': 'Personal Website', 'dir': 'me', 'depends': 'traefik'})
skipping: [servyy-test.lxd] => (item={'name': 'Job Management', 'dir': 'jobs', 'depends': 'traefik', 'manual': {}}) 
ok: [servyy-test.lxd] => (item={'name': 'Passbolt', 'dir': 'pass', 'depends': 'traefik'})
changed: [servyy-test.lxd] => (item={'name': 'Monitor', 'dir': 'monitor', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Energy', 'dir': 'energy', 'depends': 'traefik'})

TASK [user : Ensure lingering enabled] *****************************************
ok: [servyy-test.lxd]

TASK [user : Check mandatory variables are defined] ****************************
ok: [servyy-test.lxd]

TASK [user : Create the systemd directory if it does not exist] ****************
ok: [servyy-test.lxd]

TASK [user : Create docker-photo-index service] ********************************
ok: [servyy-test.lxd]

TASK [user : Create timer for docker-photo-index] ******************************
ok: [servyy-test.lxd]

TASK [user : Start timer for docker-photo-index] *******************************
ok: [servyy-test.lxd]

TASK [user : Dig servers ip] ***************************************************
ok: [servyy-test.lxd]

TASK [user : Create host list for services] ************************************
ok: [servyy-test.lxd] => (item={'name': 'Traefik', 'dir': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Achim Höfer', 'dir': 'achim-hoefer', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Git', 'dir': 'git', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Photoprism', 'dir': 'photoprism', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Bumbleflies', 'dir': 'bumbleflies', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Portainer', 'dir': 'portainer', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'PiHole', 'dir': 'dns', 'depends': 'traefik', 'manual': {}})
ok: [servyy-test.lxd] => (item={'name': 'Personal Website', 'dir': 'me', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Job Management', 'dir': 'jobs', 'depends': 'traefik', 'manual': {}})
ok: [servyy-test.lxd] => (item={'name': 'Passbolt', 'dir': 'pass', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Monitor', 'dir': 'monitor', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'name': 'Energy', 'dir': 'energy', 'depends': 'traefik'})
ok: [servyy-test.lxd] => (item={'dir': 'pihole.dns'})

TASK [user : Create host list for server] **************************************
ok: [servyy-test.lxd]

TASK [user : Install rsync] ****************************************************
ok: [servyy-test.lxd]

TASK [user : Ensure backup dir exists] *****************************************
ok: [servyy-test.lxd]

TASK [user : Create backup for homes] ******************************************
ok: [servyy-test.lxd]

TASK [user : Check mandatory variables are defined] ****************************
skipping: [servyy-test.lxd]

TASK [user : Create the systemd directory if it does not exist] ****************
skipping: [servyy-test.lxd]

TASK [user : Create backup-homes service] **************************************
skipping: [servyy-test.lxd]

TASK [user : Create timer for backup-homes] ************************************
skipping: [servyy-test.lxd]

TASK [user : Start timer for backup-homes] *************************************
skipping: [servyy-test.lxd]

TASK [user : Create backup for server] *****************************************
ok: [servyy-test.lxd]

TASK [user : Check mandatory variables are defined] ****************************
skipping: [servyy-test.lxd]

TASK [user : Create the systemd directory if it does not exist] ****************
skipping: [servyy-test.lxd]

TASK [user : Create backup-root service] ***************************************
skipping: [servyy-test.lxd]

TASK [user : Create timer for backup-root] *************************************
skipping: [servyy-test.lxd]

TASK [user : Start timer for backup-root] **************************************
skipping: [servyy-test.lxd]

TASK [user : Check mandatory variables are defined] ****************************
skipping: [servyy-test.lxd]

TASK [user : Create the systemd directory if it does not exist] ****************
skipping: [servyy-test.lxd]

TASK [user : Create backup-photos service] *************************************
skipping: [servyy-test.lxd]

TASK [user : Create timer for backup-photos] ***********************************
skipping: [servyy-test.lxd]

TASK [user : Start timer for backup-photos] ************************************
skipping: [servyy-test.lxd]

TASK [user : Create restic log directory] **************************************
ok: [servyy-test.lxd]

TASK [user : Create restic config directory (system-wide)] *********************
ok: [servyy-test.lxd]

TASK [user : Deploy restic environment files (system-wide)] ********************
changed: [servyy-test.lxd] => (item={'name': 'home', 'repository': 'sftp://storagebox/backup/servyy-test.lxd/restic-home', 'password': '2joaLNNlEuNvFBBCl0FjCLhyAJxKgoc2', 'env_name': 'home'})
changed: [servyy-test.lxd] => (item={'name': 'root', 'repository': 'sftp://storagebox/backup/servyy-test.lxd/restic-root', 'password': 'iXyHBjnL6pyE5tqNqiq8SB4oK0bCYMR4', 'env_name': 'root'})

TASK [user : Create restic config directory for user] **************************
ok: [servyy-test.lxd]

TASK [user : Create default restic environment for user (symlink to home)] *****
ok: [servyy-test.lxd]

TASK [user : Create restic config directory for root] **************************
ok: [servyy-test.lxd]

TASK [user : Create default restic environment for root (symlink to root repo)] ***
ok: [servyy-test.lxd]

TASK [user : Ensure .ssh directory exists] *************************************
ok: [servyy-test.lxd]

TASK [user : Copy Storage Box SSH private key to server] ***********************
ok: [servyy-test.lxd]

TASK [user : Copy Storage Box SSH public key to server] ************************
ok: [servyy-test.lxd]

TASK [user : Deploy SSH config for Storage Box] ********************************
ok: [servyy-test.lxd]

TASK [user : Create restic repository directories on Storage Box] **************
changed: [servyy-test.lxd]

TASK [user : Initialize restic repositories] ***********************************
ok: [servyy-test.lxd] => (item={'enabled': True, 'repository': 'sftp://storagebox/backup/servyy-test.lxd/restic-home', 'password': '2joaLNNlEuNvFBBCl0FjCLhyAJxKgoc2', 'source_path': '/home/cda', 'excludes': ['**/.git', '**/.git/worktrees', '.zprezto/.git', '.cache', '**/.cache', '**/node_modules', '**/__pycache__', '**/.pytest_cache', '**/.mypy_cache', '**/.tox', '**/.venv', '**/target', '**/dist', '**/build', 'pgdata', 'go/pkg', 'go/bin', '**/*.tmp', '**/*.swp', '**/*~']})
ok: [servyy-test.lxd] => (item={'enabled': True, 'repository': 'sftp://storagebox/backup/servyy-test.lxd/restic-root', 'password': 'iXyHBjnL6pyE5tqNqiq8SB4oK0bCYMR4', 'source_path': '/', 'includes': ['/etc', '/var'], 'excludes': ['/proc', '/sys', '/dev', '/run', '/tmp', '/mnt', '/media', '/var/lib/docker', '/var/cache', '/var/tmp', '/var/log/*.gz', '/var/log/*.1', '/var/log/*.2', '/var/log/*.3', '/var/log/*.old', '/var/log/journal', '*.sock', 'swap.img', '*.swap']})

TASK [user : Create restic log files with correct permissions] *****************
ok: [servyy-test.lxd] => (item=/var/log/restic/backup-home.log)
ok: [servyy-test.lxd] => (item=/var/log/restic/backup-root.log)
ok: [servyy-test.lxd] => (item=/var/log/restic/forget.log)
ok: [servyy-test.lxd] => (item=/var/log/restic/check.log)

TASK [user : Ensure root .ssh directory exists] ********************************
ok: [servyy-test.lxd]

TASK [user : Copy Storage Box SSH keys to root] ********************************
ok: [servyy-test.lxd] => (item=id_storagebox)
ok: [servyy-test.lxd] => (item=id_storagebox.pub)

TASK [user : Deploy SSH config for Storage Box (root)] *************************
ok: [servyy-test.lxd]

TASK [user : Create backup scripts directory] **********************************
ok: [servyy-test.lxd]

TASK [user : Deploy restic backup script for home] *****************************
ok: [servyy-test.lxd]

TASK [user : Check mandatory variables are defined] ****************************
ok: [servyy-test.lxd]

TASK [user : Create the systemd directory if it does not exist] ****************
ok: [servyy-test.lxd]

TASK [user : Create restic-backup-home service] ********************************
ok: [servyy-test.lxd]

TASK [user : Create timer for restic-backup-home] ******************************
ok: [servyy-test.lxd]

TASK [user : Start timer for restic-backup-home] *******************************
ok: [servyy-test.lxd]

TASK [user : Deploy restic backup script for root] *****************************
ok: [servyy-test.lxd]

TASK [user : Check mandatory variables are defined] ****************************
ok: [servyy-test.lxd]

TASK [user : Create the systemd directory if it does not exist] ****************
ok: [servyy-test.lxd]

TASK [user : Create restic-backup-root service] ********************************
ok: [servyy-test.lxd]

TASK [user : Create timer for restic-backup-root] ******************************
ok: [servyy-test.lxd]

TASK [user : Start timer for restic-backup-root] *******************************
ok: [servyy-test.lxd]

TASK [user : Create file to test hosts up] *************************************
ok: [servyy-test.lxd]

PLAY [Setup League Sphere (Production & Staging)] ******************************

TASK [Gathering Facts] *********************************************************
ok: [servyy-test.lxd]

TASK [ls_setup : Create ls group [leaguesphere]] *******************************
ok: [servyy-test.lxd]

TASK [ls_setup : Add [cda] to [leaguesphere]] **********************************
ok: [servyy-test.lxd]

TASK [ls_setup : Get [cda]s groups] ********************************************
ok: [servyy-test.lxd]

TASK [ls_setup : Filter out jail group] ****************************************
ok: [servyy-test.lxd]

TASK [ls_setup : Apply updated groups] *****************************************
ok: [servyy-test.lxd]

TASK [ls_setup : Adding ls user 'leaguesphere' to group docker] ****************
ok: [servyy-test.lxd]

TASK [ls_setup : Ensure /var/run exists] ***************************************
ok: [servyy-test.lxd]

TASK [ls_setup : Ensure docker socket exists in jail] **************************
ok: [servyy-test.lxd]

TASK [ls_setup : Copy systemd mount unit template] *****************************
ok: [servyy-test.lxd]

TASK [ls_setup : Reload systemd if mount unit changed] *************************
skipping: [servyy-test.lxd]

TASK [ls_setup : Ensure Docker socket mount is enabled and started] ************
ok: [servyy-test.lxd]

TASK [ls_setup : Extra ssh_chroot variables for ssh jail] **********************
ok: [servyy-test.lxd] => {
    "msg": {
        "ansible_playbook_python": "/home/cda/.pyenv/versions/3.14.0/envs/servy-ansible/bin/python",
        "extra_ssh_chroot_bins": [
            "/usr/bin/docker",
            "/usr/bin/wget",
            "/usr/bin/ar",
            "/usr/bin/tar",
            "/usr/bin/curl",
            "/usr/lib/x86_64-linux-gnu/libcurl-gnutls.so.4"
        ],
        "extra_ssh_chroot_copy_extra_items": [
            "/etc/resolv.conf",
            "/etc/ssl/certs/",
            "/usr/libexec/docker/"
        ],
        "extra_ssh_chroot_jail_dirs": [
            "/usr/lib/x86_64-linux-gnu",
            "/etc/ssl",
            "/usr/libexec/docker",
            "/tmp/"
        ]
    }
}

TASK [ls_setup : Combine ssh_chroot variables for ssh jail] ********************
ok: [servyy-test.lxd]
[DEPRECATION WARNING]: INJECT_FACTS_AS_VARS default to `True` is deprecated, top-level facts will not be auto injected after the change. This feature will be removed from ansible-core version 2.24.
Origin: /home/cda/.ansible/roles/geerlingguy.security/tasks/main.yml:3:17

1 ---
2 - name: Include OS-specific variables.
3   include_vars: "{{ ansible_os_family }}.yml"
                  ^ column 17

Use `ansible_facts["fact_name"]` (no `ansible_` prefix) instead.


TASK [geerlingguy.security : Include OS-specific variables.] *******************
ok: [servyy-test.lxd]

TASK [geerlingguy.security : include_tasks] ************************************
skipping: [servyy-test.lxd]

TASK [geerlingguy.security : include_tasks] ************************************
included: /home/cda/.ansible/roles/geerlingguy.security/tasks/ssh.yml for servyy-test.lxd

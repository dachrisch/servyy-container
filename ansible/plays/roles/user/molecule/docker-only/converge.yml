---
- name: Converge (User Docker-Only)
  hosts: all
  become: true
  become_user: testuser
  vars:
    create_user: testuser
    with_docker: true
    with_containers: true
    check_git_servyy_reachable: false
    extension_drive:
      path: /mnt/mock_volume
      device: /dev/null
      fstype: ext4
      opts: discard,defaults
  tasks:
    # Test Docker setup tasks only - use include_role to maintain role context
    - name: Run user role tasks (docker_setup)
      include_role:
        name: user
        tasks_from: docker_setup
      tags: [user.docker.setup]
      when: (with_docker or with_containers) | default(false)

    # Skip: repository cloning (requires git.lehel.xyz), docker_services (requires compose files),
    # dns tasks, backup, restic, host_ping
